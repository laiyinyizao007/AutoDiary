# WiFi连接测试指南

## 测试环境配置

### 服务器状态
- ✅ 简单测试服务器已启动
- 🎥 视频WebSocket服务器: `ws://192.168.137.1:8000/video`
- 🎤 音频WebSocket服务器: `ws://192.168.137.1:8001/audio`
- 📡 服务器正在等待ESP32设备连接

### ESP32固件配置
- 📱 设备: Seeed Studio XIAO ESP32S3 Sense
- 🌐 WiFi网络: "Avery"
- 🔐 WiFi密码: "102938475"
- 🎯 服务器IP: 192.168.137.1
- 📊 视频端口: 8000, 音频端口: 8001

## 测试步骤

### 1. 硬件连接
1. 确保ESP32设备通过USB连接到电脑
2. 检查设备是否被正确识别

### 2. 烧录固件
```bash
cd c:\Dev\projects\AutoDiary\AutoDiary
pio run --target upload
```

### 3. 监控串口输出
```bash
pio device monitor
```

### 4. 预期输出序列

#### 启动阶段
```
========================================
AutoDiary - 调试版本 v1.0-debug
========================================
固件版本: v1.0-debug
编译时间: Nov 29 2025 03:47:10
正在初始化系统...

🔧 开始初始化硬件组件...

1️⃣ 初始化WiFi...
连接WiFi...
SSID: Avery
连接中............
✅ WiFi连接成功！
IP地址: 192.168.137.xxx
信号强度: -xx dBm

📊 系统状态:
  WiFi连接: ✅ 已连接
  摄像头: ❌ 未初始化
  视频WebSocket: ❌ 未连接
  音频WebSocket: ❌ 未连接
  WiFi IP: 192.168.137.xxx
   信号强度: -xx dBm
```

#### 硬件初始化阶段
```
📷 初始化摄像头...
✅ 摄像头初始化成功！
摄像头型号: OV2640
分辨率: 640x480
JPEG质量: 10

🎤 初始化I2S麦克风...
✅ I2S麦克风初始化成功！
采样率: 16000 Hz
通道数: 1
采样深度: 16 bits
```

#### WebSocket连接阶段
```
🌐 初始化WebSocket连接...
连接视频WebSocket: 192.168.137.1:8000/video
连接音频WebSocket: 192.168.137.1:8001/audio
✅ WebSocket连接初始化完成

📡 等待连接服务器...
🎥 视频服务器: ws://192.168.137.1:8000/video
🎤 音频服务器: ws://192.168.137.1:8001/audio
```

#### 运行阶段
```
🚀 创建任务...
🎥 视频捕获任务已启动
🎤 音频捕获任务已启动
✅ 系统初始化完成！

🎥 视频WebSocket连接成功！
📱 发送设备信息: {"type":"device_info","device":"XIAO_ESP32S3_SENSE_DEBUG",...}

🎤 音频WebSocket连接成功！
🎵 发送音频配置: {"type":"audio_config","sample_rate":16000,...}

💓 发送心跳包...
```

### 5. 服务器端预期输出

当ESP32成功连接时，测试服务器会显示：
```
🎥 视频客户端连接: video_xxx
🎤 音频客户端连接: audio_xxx
📱 硬件设备信息更新: {"type":"device_info",...}
🎵 硬件音频配置: {"type":"audio_config",...}
💓 收到设备心跳 (video): video_xxx
💓 收到设备心跳 (audio): audio_xxx
📸 硬件图像保存: data/real_test/hardware_image_xxx.jpg
🎤 硬件音频保存: data/real_test/hardware_audio_xxx.raw
🎥 硬件视频流: 30 帧, 当前图像大小: xxxxx bytes
🎤 硬件音频流: 500 包, 当前包大小: 1024 bytes
```

## 故障排除

### WiFi连接失败
**症状**: `❌ WiFi连接失败！`
**可能原因**:
- WiFi网络名称或密码错误
- WiFi网络不可用
- 路由器问题
- ESP32硬件问题

**解决方案**:
1. 检查WiFi网络名称和密码
2. 确认WiFi网络正常工作
3. 尝试靠近路由器
4. 重启ESP32设备

### WebSocket连接失败
**症状**: `❌ 视频/音频WebSocket错误！`
**可能原因**:
- 服务器未运行
- 防火墙阻止连接
- IP地址配置错误
- 端口被占用

**解决方案**:
1. 确认测试服务器正在运行
2. 检查防火墙设置
3. 验证服务器IP地址
4. 确认端口8000和8001可用

### 摄像头初始化失败
**症状**: `❌ 摄像头初始化失败`
**可能原因**:
- 摄像头硬件连接问题
- 引脚配置错误
- 电源问题

**解决方案**:
1. 检查摄像头连接
2. 验证引脚配置
3. 检查电源供应

### I2S麦克风问题
**症状**: `❌ I2S初始化失败`
**可能原因**:
- 麦克风硬件连接问题
- 引脚配置错误

**解决方案**:
1. 检查麦克风连接
2. 验证I2S引脚配置 (ws=42, sck=41)

## 测试数据

成功连接后，测试数据将保存在：
- 📸 图像数据: `data/real_test/hardware_image_*.jpg`
- 🎤 音频数据: `data/real_test/hardware_audio_*.raw`

## 测试完成

当看到以下信息时，表示WiFi连接测试成功：
1. ✅ ESP32成功连接到WiFi网络
2. ✅ 获得有效的IP地址
3. ✅ 成功连接到WebSocket服务器
4. ✅ 服务器收到设备信息和心跳包
5. ✅ 开始传输视频和音频数据

---
**测试时间**: 2025-11-29 03:47:xx
**固件版本**: v1.0-debug
**硬件平台**: Seeed Studio XIAO ESP32S3 Sense
